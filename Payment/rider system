<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rider Delivery System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #map { height: 400px; width: 100%; margin: 10px auto; }
        .container { max-width: 800px; margin: auto; padding: 20px; }
        button { background-color: #007bff; color: white; padding: 8px 12px; cursor: pointer; border-radius: 5px; border: none; }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Rider Delivery System</h1>
        <p>Click the map to set pickup & delivery locations.</p>

        <h2>Current Delivery</h2>
        <div id="currentOrder">
            <p><strong>Pickup:</strong> <span id="pickupLocation">Not Set</span></p>
            <p><strong>Delivery:</strong> <span id="deliveryLocation">Not Set</span></p>
            <button onclick="resetMarkers()">Reset Locations</button>
        </div>

        <h2>Navigation</h2>
        <div id="map"></div>
    </div>

    <script>
        let map = L.map('map').setView([3.139, 101.686], 12); // Kuala Lumpur

        // åŠ è½½ OSM åœ°å›¾
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        let pickupMarker, deliveryMarker, routeLine;

        // ç‚¹å‡»åœ°å›¾è®¾å®šå–è´§ & é€è´§åœ°ç‚¹
        map.on("click", function (e) {
            let latlng = e.latlng;

            if (!pickupMarker) {
                pickupMarker = L.marker(latlng).addTo(map)
                    .bindPopup("ğŸ“ Pickup Location").openPopup();
                document.getElementById("pickupLocation").innerText = `Lat: ${latlng.lat}, Lng: ${latlng.lng}`;
                alert("âœ… Pickup location set!");
            } else if (!deliveryMarker) {
                deliveryMarker = L.marker(latlng).addTo(map)
                    .bindPopup("ğŸ“¦ Delivery Location").openPopup();
                document.getElementById("deliveryLocation").innerText = `Lat: ${latlng.lat}, Lng: ${latlng.lng}`;
                alert("âœ… Delivery location set!");

                // ğŸš€ è°ƒç”¨è·¯çº¿ç»˜åˆ¶å‡½æ•°
                drawRoute(pickupMarker.getLatLng(), deliveryMarker.getLatLng());
            }
        });

        // ğŸš— è·å– OSRM è·¯çº¿
        function drawRoute(start, end) {
            let url = `https://router.project-osrm.org/route/v1/driving/${start.lng},${start.lat};${end.lng},${end.lat}?overview=full&geometries=geojson`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.code !== "Ok") {
                        alert("ğŸš¨ è·¯çº¿è·å–å¤±è´¥ï¼Œè¯·é‡è¯•ï¼");
                        return;
                    }

                    // æ¸…é™¤æ—§è·¯çº¿
                    if (routeLine) map.removeLayer(routeLine);

                    // ğŸš€ åœ¨åœ°å›¾ä¸Šç»˜åˆ¶è·¯çº¿
                    routeLine = L.geoJSON(data.routes[0].geometry, {
                        style: { color: "blue", weight: 5 }
                    }).addTo(map);

                    // ğŸ” è‡ªåŠ¨è°ƒæ•´åœ°å›¾è§†å›¾
                    map.fitBounds(routeLine.getBounds());
                })
                .catch(error => {
                    alert("âŒ è·¯çº¿æ•°æ®è¯·æ±‚å¤±è´¥ï¼");
                    console.error("Error fetching route:", error);
                });
        }

        // âŒ é‡æ–°é€‰æ‹© Pickup & Delivery
        function resetMarkers() {
            if (pickupMarker) { map.removeLayer(pickupMarker); pickupMarker = null; }
            if (deliveryMarker) { map.removeLayer(deliveryMarker); deliveryMarker = null; }
            if (routeLine) { map.removeLayer(routeLine); routeLine = null; }

            document.getElementById("pickupLocation").innerText = "Not Set";
            document.getElementById("deliveryLocation").innerText = "Not Set";
            alert("ğŸ“ ä½ç½®å·²é‡ç½®ï¼Œè¯·é‡æ–°é€‰æ‹©ï¼");
        }
    </script>

</body>
</html>
